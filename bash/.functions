

switch() {
  plugins="$(asdf plugin-list)"

  if [[ $plugins =~ .*$1.* ]]; then
    # plugin installed

    version="$(asdf list $1)"
    if [[ $version != *"$2"* ]]; then
      # version isn't installed
      echo "Installing version now."
      asdf install $1 $2
    fi

    if [[ -f $PWD/.tool-versions ]]; then
      # local setting
      asdf local $1 $2
    else
      asdf global $1 $2
    fi
  else
    echo "$1 plugin not installed, exiting."
    exit 1
  fi
}

kroll() {
  deployment="$1"
  kubectl patch deployment ${deployment} -p \
    "{\"spec\":{\"template\":{\"metadata\":{\"labels\":{\"date\":\"`date +'%s'`\"}}}}}"
}

gns() {
  if [ -z "$1" ]; then
    echo "gns <project>

    Projects:
      - stage
      - infra
      - prod
      - kishfra"

    return
  fi

  case $1 in
    stage | staging)
      GCP_PROJECT=recharge-stage-services-8e59
      CLUSTER=staging
      ;;
    infra)
      GCP_PROJECT=recharge-infra-services-8b42
      CLUSTER=infra
      ;;
    prod)
      GCP_PROJECT=recharge-prod-services-f818
      CLUSTER=prod
      ;;
    kishfra | rkish)
      GCP_PROJECT=recharge-rkish-services-5e8a
      CLUSTER=kishfra
      ;;
  esac

  gcloud config set project $GCP_PROJECT

  if [ -n "$CLUSTER" ]; then
    kubectx $CLUSTER
  fi
}
